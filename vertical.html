<!doctype html>
<html>

<head>
	<title>Bar Chart</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.js"></script>
	<script src = "https://www.chartjs.org/samples/latest/utils.js"></script>
	<script lang = "javascript" src = "crimes_parsed.js"></script>
	<script lang = "javascript" src = "scores.js"></script>
	<style>
	canvas {
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
	</style>
</head>

<body>
	<div id="container" style="width: 75%;">
		<canvas id="canvas"></canvas>
	</div>
	<button id="randomizeData">Randomize Data</button>
	<button id="addDataset">Add Dataset</button>
	<button id="removeDataset">Remove Dataset</button>
	<button id="addData">Add Data</button>
	<button id="removeData">Remove Data</button>
	<script>


// load data from file
var crimes = seasons;
var stats = scores;

function crime_rate_in(year, month) {
	return crimes[year][month]["AGG. ASSAULT"]
		+ crimes[year][month]["ASSAULT BY THREAT"]
		+ crimes[year][month]["COMMON ASSAULT"]
		+ crimes[year][month]["HOMICIDE"]
		+ crimes[year][month]["RAPE"];
}

// Compute average # of violent crimes per month for a given start month/year
// and end month/year
// Note : start and end year must be consecutive years! This works because a
// football season can occur in no more than two calendar years.
function avg_crime_per_month_in(start_year, start_month, end_year, end_month) {
	var crimes_per_month = [];
	for (var i = start_month; i < 12; i++) {
		var sum = crime_rate_in(start_year, i);
		crimes_per_month.push(sum);
  }
	if (start_year != end_year) {
		for (var i = 0; i <= end_month; i++) {
			var sum = crime_rate_in(end_year, i);
			crimes_per_month.push(sum);
		}
	}
	return average(crimes_per_month);
}

function average(arr) {
	var total = 0;
	for (var i = 0; i < arr.length; i++) {
			total += arr[i];
	}
	return total / arr.length;
}

function pickColor(year) {
	var final = scores[year][0].FINAL-45;
	console.log()
	return rgbToHex(255-Math.floor(12*final),Math.floor(12*final),0);
}

function componentToHex(c) {
    var hex = c.toString(16);
    return hex.length == 1 ? "0" + hex : hex;
}

function rgbToHex(r, g, b) {
    return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
}

function tooltip(year) {
	return "<p><b>Season: </b>" + year + "</p><p><b>% of games won: </b>" + 50 + "</p>";
}

// Calculate "crime rate" for each football Season
// where "crime rate" is defined by average number of
// violent crimes reported per month
var avg_crime_rate_by_year = {};
avg_crime_rate_by_year[2012] = avg_crime_per_month_in(2012, 8, 2013, 1);
avg_crime_rate_by_year[2013] = avg_crime_per_month_in(2013, 8, 2013, 11);
avg_crime_rate_by_year[2014] = avg_crime_per_month_in(2014, 8, 2015, 0);
avg_crime_rate_by_year[2015] = avg_crime_per_month_in(2015, 8, 2016, 0);
avg_crime_rate_by_year[2016] = avg_crime_per_month_in(2016, 8, 2017, 0);
avg_crime_rate_by_year[2017] = avg_crime_per_month_in(2017, 8, 2017, 11);
avg_crime_rate_by_year[2018] = avg_crime_per_month_in(2018, 8, 2018, 10);

var season_colors = {};

season_colors[2012] = pickColor(2012);
season_colors[2013] = pickColor(2013);
season_colors[2014] = pickColor(2014);
season_colors[2015] = pickColor(2015);
season_colors[2016] = pickColor(2016);
season_colors[2017] = pickColor(2017);
season_colors[2018] = pickColor(2018);


var MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
var color = Chart.helpers.color;
var color12 = pickColor(2012);
var yearlyOverview = {
	labels: ['2012', '2013', '2014', '2015', '2016', '2017', '2018'],
	datasets: [{
		label: 'Ravens season win/loss record',
		borderWidth: 1,
		data: [
			avg_crime_rate_by_year[2012],
			avg_crime_rate_by_year[2013],
			avg_crime_rate_by_year[2014],
			avg_crime_rate_by_year[2015],
			avg_crime_rate_by_year[2016],
			avg_crime_rate_by_year[2017],
			avg_crime_rate_by_year[2018]
		],
		backgroundColor: [
			season_colors[2012],
			season_colors[2013],
			season_colors[2014],
			season_colors[2015],
			season_colors[2016],
			season_colors[2017],
			season_colors[2018]
		],
	}]
};

var monthly_datasets = {};
monthly_datasets[2012] = {
	labels: ['September', 'October', 'November', 'December', 'January', 'February'],
	datasets: [{
		label: 'Ravens win/loss record during the 2012 NFL season',
		borderWidth: 1,
		data: [
			crime_rate_in(2012, 8),
			crime_rate_in(2012, 9),
			crime_rate_in(2012, 10),
			crime_rate_in(2012, 11),
			crime_rate_in(2013, 0),
			crime_rate_in(2013, 1),
		],
	}]
};
monthly_datasets[2013] = {
	labels: ['September', 'October', 'November', 'December'],
	datasets: [{
		label: 'Ravens win/loss record during the 2013 NFL season',
		borderWidth: 1,
		data: [
			crime_rate_in(2013, 8),
			crime_rate_in(2013, 9),
			crime_rate_in(2013, 10),
			crime_rate_in(2013, 11),
		],
	}]
}
monthly_datasets[2014] = {
	labels: ['September', 'October', 'November', 'December', 'January'],
	datasets: [{
		label: 'Ravens win/loss record during the 2014 NFL season',
		borderWidth: 1,
		data: [
			crime_rate_in(2014, 8),
			crime_rate_in(2014, 9),
			crime_rate_in(2014, 10),
			crime_rate_in(2014, 11),
			crime_rate_in(2015, 0),
		],
	}]
}
monthly_datasets[2015] = {
	labels: ['September', 'October', 'November', 'December', 'January'],
	datasets: [{
		label: 'Ravens win/loss record during the 2015 NFL season',
		borderWidth: 1,
		data: [
			crime_rate_in(2015, 8),
			crime_rate_in(2015, 9),
			crime_rate_in(2015, 10),
			crime_rate_in(2015, 11),
			crime_rate_in(2016, 0),
		],
	}]
}
monthly_datasets[2016] = {
	labels: ['September', 'October', 'November', 'December', 'January'],
	datasets: [{
		label: 'Ravens win/loss record during the 2016 NFL season',
		borderWidth: 1,
		data: [
			crime_rate_in(2016, 8),
			crime_rate_in(2016, 9),
			crime_rate_in(2016, 10),
			crime_rate_in(2016, 11),
			crime_rate_in(2017, 0),
		],
	}]
}
monthly_datasets[2017] = {
	labels: ['September', 'October', 'November', 'December'],
	datasets: [{
		label: 'Ravens win/loss record during the 2017 NFL season',
		borderWidth: 1,
		data: [
			crime_rate_in(2017, 8),
			crime_rate_in(2017, 9),
			crime_rate_in(2017, 10),
			crime_rate_in(2017, 11),
		],
	}]
}


window.onload = function() {
	var ctx = document.getElementById('canvas').getContext('2d');
	window.myBar = new Chart(ctx, {
		type: 'bar',
		data: yearlyOverview,

		options: {
			responsive: true,
			legend: {
				position: 'top',
				labels: {
					fontSize: 16,
					fontColor: '#000'
				}
			},

			title: {
				display: true,
				fontSize: 18,
				fontColor: '#000',
				text: 'Baltimore Ravens: Season Record and Violent Crime'
			},

			scales: {
				yAxes:[{
					scaleLabel: {
						display: true,
						fontSize: 18,
						fontColor: '#000',
						labelString: 'Average Crimes Per Month (CPM)'
					},
					ticks: {
						beginAtZero: true
					}
				}]
			},
			onClick: yearly_to_monthly,
		}
	});

};


function yearly_to_monthly (event, array) {
	var year = array[0]["_model"]["label"];
	console.log("You clicked: " + year);
	window.myBar.destroy();
	var ctx = document.getElementById('canvas').getContext('2d');
	window.myBar = new Chart(ctx, {
		type: 'bar',
		data: monthly_datasets[year],
		options: {
			responsive: true,
			legend: {
				labels: {
					fontSize: 16,
					fontColor: '#000'
				},
				position: 'top',
			},
			title: {
				display: true,
				text: 'Baltimore Ravens: Season Record and Violent Crime'
			},
			scales: {
				yAxes:[{
					ticks: {
						beginAtZero: true
					}
				}]
			},
			onClick: monthly_to_yearly,
		}

	});
};

function monthly_to_yearly (event, array) {
	var year = array[0]["_model"]["label"];
	console.log("You clicked: " + year);
	window.myBar.destroy();
	var ctx = document.getElementById('canvas').getContext('2d');
	window.myBar = new Chart(ctx, {
		type: 'bar',
		data: yearlyOverview,
		options: {
			responsive: true,
			legend: {
				position: 'top',
			},
			title: {
				display: true,
				text: 'Baltimore Ravens: Season Record and Violent Crime'
			},
			scales: {
				yAxes:[{
					ticks: {
						beginAtZero: true
					}
				}]
			},
			onClick: yearly_to_monthly,
		}

	});
};

/*
document.getElementById('randomizeData').addEventListener('click', function() {
	var zero = Math.random() < 0.2 ? true : false;
	barChartData.datasets.forEach(function(dataset) {
		dataset.data = dataset.data.map(function() {
			return zero ? 0.0 : randomScalingFactor();
		});

	});
	window.myBar.update();
});

var colorNames = Object.keys(window.chartColors);
document.getElementById('addDataset').addEventListener('click', function() {
	var colorName = colorNames[barChartData.datasets.length % colorNames.length];
	var dsColor = window.chartColors[colorName];
	var newDataset = {
		label: 'Dataset ' + (barChartData.datasets.length + 1),
		backgroundColor: color(dsColor).alpha(0.5).rgbString(),
		borderColor: dsColor,
		borderWidth: 1,
		data: []
	};

	for (var index = 0; index < barChartData.labels.length; ++index) {
		newDataset.data.push(randomScalingFactor());
	}
	console.log("yoyoyo");
	barChartData.datasets.push(newDataset);
	window.myBar.update();
});

document.getElementById('addData').addEventListener('click', function() {
	if (barChartData.datasets.length > 0) {
		var month = MONTHS[barChartData.labels.length % MONTHS.length];
		barChartData.labels.push(month);

		for (var index = 0; index < barChartData.datasets.length; ++index) {
			// window.myBar.addData(randomScalingFactor(), index);
			barChartData.datasets[index].data.push(randomScalingFactor());
		}

		window.myBar.update();
	}
});

document.getElementById('removeDataset').addEventListener('click', function() {
	barChartData.datasets.pop();
	window.myBar.update();
});

document.getElementById('removeData').addEventListener('click', function() {
	barChartData.labels.splice(-1, 1); // remove the label first

	barChartData.datasets.forEach(function(dataset) {
		dataset.data.pop();
	});

	window.myBar.update();
});*/
	</script>
</body>

</html>
